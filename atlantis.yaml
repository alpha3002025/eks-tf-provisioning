version: 3
automerge: true
projects:
  - name: init/overtake ## (1)
    dir: terraform/init/overtake ## (1)
    workspace: default
    terraform_version: 1.3.7
    autoplan:
      when_modified: [
         "*.tf"
      ]
      enabled: true
    apply_requirements: []
    workflow: tf-plan-apply ## (2)
  - name: vpc/eksd_apnortheast2
    dir: terraform/vpc/eksd_apnortheast2
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
         "*.tf",
         "*.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: tf-plan-apply
  - name: eks/eksd_apnortheast2/eksdapne2-tcjc
    dir: terraform/eks/eksd_apnortheast2/eksdapne2-tcjc
    workspace: default
    terraform_version: 1.7.0
    autoplan:
      when_modified: [
        "../../_module/**",
        "*.tf",
        "*.tfvars"
      ]
      enabled: true
    apply_requirements: []
    workflow: tf-plan-apply

#### Workflows #####
workflows:
  tf-plan-apply: ## (3)
    plan: ## (4)
      steps:
        - init:
            extra_args: [
              '-backend-config="role_arn=arn:aws:iam::533267446521:role/atlantis-overtake-admin"',
              '-upgrade=false'
            ]
        - plan:
            extra_args: [
              "-var 'assume_role_arn=arn:aws:iam::533267446521:role/atlantis-overtake-admin'"
            ]
    apply: ## (5)
      steps:
        - apply